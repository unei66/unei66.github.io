<!DOCTYPE HTML>

    <html lang="zh-Hans">
  
<head>
  <meta charset="utf-8">
  
  <title>tomcatå¼‚å¸¸åˆ†æ | Hello World</title>
  <meta name="author" content="hello world">
  
  <meta name="description" content="å‘ç°åŠä¸ªæœˆå‰å‘ç°ï¼Œé‚®ä»¶æŠ¥è­¦ï¼Œçº¿ä¸Šçš„tomcatä¸€ç›´åœ¨æŠ¥ç›‘æ§æ¥å£è¶…æ—¶ï¼Œè¿™ä¸ªç›‘æ§æ¥å£å°±æ˜¯è¿”å›ä¸ªhello world,æ²¡æœ‰ä¾èµ–å…¶ä»–ç³»ç»Ÿã€‚è¿™ä¸ªæŠ¥è­¦ï¼Œå¤§çº¦å‡ ä¸ªå°æ—¶æ¥ä¸€æ¬¡ã€‚
çº¿ä¸Šç›‘æ§
ç›‘æ§æ¥å£è¯·æ±‚è€—æ—¶ç›‘æ§




ç½‘ç»œç›‘æ§




cpuç›‘æ§


jstat



æ¨æ–­ä»ä¸Šé¢ä¸‰ä¸ªå¯ä»¥çœ‹å‡ºï¼Œæœºå™¨æ²¡æ­»ï¼Œæ´»ç€å‘¢ï¼Œç½‘">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="tomcatå¼‚å¸¸åˆ†æ"/>
  <meta property="og:site_name" content="Hello World"/>

  
    <meta property="og:image" content=""/>
  

  
    <meta http-equiv="Content-Language" content="zh-Hans"/>
  

  <link href="/img/favicon.png" rel="icon">
  
    <link rel="apple-touch-icon" href="/img/apple-icon.png">
    <link rel="apple-touch-icon-precomposed" href="/img/apple-icon.png">
    

  <link rel="alternate" href="/atom.xml" title="Hello World" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
  <style type="text/css">
  /* Tim Pietrusky advanced checkbox hack (Android <= 4.1.2) */
body{ -webkit-animation: bugfix infinite 1s; }
@-webkit-keyframes bugfix { from {padding:0;} to {padding:0;} }

  
  <!-- Chinese readability improvements -->
    article {font-weight: 400;letter-spacing: .01rem;}
    article .entry{line-height:2;}
  

  
    article .post-content-index .entry{max-height: 550px; overflow:hidden;}
  
</style>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
 
</script>




  
  
</head>


<body>
  <header id="header" class="inner"><div class="padding">
	<div class="alignleft logo">
	  <h1><a href="/">Hello World</a></h1>
	</div>
	<nav id="main-nav" class="alignright">
		<input type="checkbox" id="toggle" />
		<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu" onclick><i class="fa fa-bars"></i></label>
	  <ul class="menu">
	    
	      <li><a href="/">Home</a></li>
	    
	      <li><a href="/archives">Archives</a></li>
	    
	    
	  </ul>
	</nav>
	<div class="clearfix"></div>
</div>
</header>
  <div id="page-heading-wrap">
  	<div class="inner">
      <div class="padding">
    		
          <h1>tomcatå¼‚å¸¸åˆ†æ</h1>
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-04-25T16:00:00.000Z">2018-04-26</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
            </li>
          </ul>
        
      </div>
  	</div>
  </div>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper" class="padding"><article class="post">
  
  
    <div class="post-content">
  
      
      <div class="entry">
        
          <h3 id="å‘ç°"><a href="#å‘ç°" class="headerlink" title="å‘ç°"></a>å‘ç°</h3><p>åŠä¸ªæœˆå‰å‘ç°ï¼Œé‚®ä»¶æŠ¥è­¦ï¼Œçº¿ä¸Šçš„tomcatä¸€ç›´åœ¨æŠ¥ç›‘æ§æ¥å£è¶…æ—¶ï¼Œè¿™ä¸ªç›‘æ§æ¥å£å°±æ˜¯è¿”å›ä¸ªhello world,æ²¡æœ‰ä¾èµ–å…¶ä»–ç³»ç»Ÿã€‚è¿™ä¸ªæŠ¥è­¦ï¼Œå¤§çº¦å‡ ä¸ªå°æ—¶æ¥ä¸€æ¬¡ã€‚</p>
<h3 id="çº¿ä¸Šç›‘æ§"><a href="#çº¿ä¸Šç›‘æ§" class="headerlink" title="çº¿ä¸Šç›‘æ§"></a>çº¿ä¸Šç›‘æ§</h3><ol>
<li><p>ç›‘æ§æ¥å£è¯·æ±‚è€—æ—¶ç›‘æ§</p>
<p><img src="/images/image003.png" alt="image003"></p>
</li>
</ol>
<ol start="2">
<li><p>ç½‘ç»œç›‘æ§</p>
<p><img src="/images/java-tomcat-gc/image001.png" alt="image001"></p>
</li>
</ol>
<ol start="3">
<li><p>cpuç›‘æ§</p>
<p><img src="/images/java-tomcat-gc/image002.png" alt="image002"></p>
</li>
<li><p>jstat</p>
<p><img src="/images/java-tomcat-gc/gcutil.png" alt="gcutil"></p>
</li>
</ol>
<h3 id="æ¨æ–­"><a href="#æ¨æ–­" class="headerlink" title="æ¨æ–­"></a>æ¨æ–­</h3><p>ä»ä¸Šé¢ä¸‰ä¸ªå¯ä»¥çœ‹å‡ºï¼Œæœºå™¨æ²¡æ­»ï¼Œæ´»ç€å‘¢ï¼Œç½‘ç»œåœæ­¢äº†ï¼Œä¼°è®¡jvmåœ¨gcï¼ˆæœ€åè¯å®ç¡®å®å¦‚æ­¤ï¼‰ã€‚</p>
<h3 id="ä¼˜åŒ–æ€è·¯"><a href="#ä¼˜åŒ–æ€è·¯" class="headerlink" title="ä¼˜åŒ–æ€è·¯"></a>ä¼˜åŒ–æ€è·¯</h3><p>çœ‹ä¸€ä¸‹åŸå§‹çš„jvmå‚æ•°ï¼ˆè¿™ä¸ªå‚æ•°ä¸æ˜¯æˆ‘é…çš„ğŸ˜‚ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseCompressedOops -Xms7G -Xmx7G -XX:MetaspaceSize=64M -XX:+MaxMetaspaceSize=384M -Xloggc:path/log.log -verbose:gc  -XX:HeapDumpPath=/tmp -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+UseConcMarkSweepGC -XX:+UseCMSCompactAtFullCollection -XX:+CMSClassUnloadingEnabled -XX:ParallelGCThreads=4 -XX:ConcGCThreads=2 -XX:+HeapDumpOnOutOfMemoryError -XX:SurvivorRatio=26 -XX:+CMSParallelRemarkEnabled -XX:CMSInitiatingOccupancyFraction=80</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œæˆ‘éœ€è¦çœ‹ä¸€ä¸‹gc logï¼Œç»“æœè¿ç»´æ‰¾ä¸åˆ°æ—¥å¿—ï¼Œå°´å°¬ï¼Œç›¸å¯¹è·¯å¾„ï¼Œæ—¥å¿—å°±æ²¡è¾“å‡ºã€‚ç¬¬äºŒï¼Œæˆ‘è¦çœ‹ä¸€ä¸‹fgcå‰åçš„å †å˜åŒ–æƒ…å†µï¼Œç„¶åå°±åŠ äº†ä¸‹é¢çš„å‚æ•°ï¼š</p>
<p>-XX:+HeapDumpBeforeFullGC -XX:+HeadDumpAfterFullGC</p>
<p>è¿™ä¿©ä¸œè¥¿å°±ä¸€èµ·æåˆ°çº¿ä¸Šå»äº†ã€‚</p>
<p>ç„¶åã€‚ã€‚ã€‚ç­‰å¾…é—®é¢˜å¤ç°ã€‚</p>
<p>æŠ“åˆ°äº†ï¼Œçœ‹gclogï¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2018-04-25T09:58:55.273+0800: 39018.975: [GC (Allocation Failure) 39018.976: [ParNew (promotion failed): 328576K-&gt;328576K(328576K), 0.2897109 secs]39019.266: [CMS2018-04-25T09:59:37.021+0800: 39060.736: [CMS-concurrent-sweep: 61.437/80.407 secs] [Times: user=85.18 sys=9.30, real=80.42 secs]</span><br><span class="line"> (concurrent mode failure): 5754419K-&gt;709193K(6999296K), 93.9618683 secs] 6066058K-&gt;709193K(7327872K), [Metaspace: 125046K-&gt;125046K(1167360K)], 94.2613781 secs] [Times: user=8.22 sys=3.47, real=94.26 secs]</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™é‡Œï¼Œå°±å‘ç°é—®é¢˜ä¸å¯¹åŠ²äº†ï¼Œconcurrent mode failureï¼Œreal 80.42, 94.26ã€‚</p>
<p>å…¶å®åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘æ²¡ä»”ç»†ç®—gcå‰åçš„heapå¤§å°ï¼Œåˆå»çœ‹äº†ä¸€ä¸‹heap dumpï¼Œdumpä¹Ÿæ²¡çœ‹å‡ºæ¥å•¥ï¼Œä½†æ˜¯ï¼Œfgcå‰åçš„æ–‡ä»¶å¤§å°å·®è·å°±å¤§äº†ï¼Œä¸€ä¸ª6.5gï¼Œä¸€ä¸ª600mã€‚è¿™ä¸ªæé†’æˆ‘å»çœ‹ä¸€ä¸‹gc logã€‚</p>
<p>youngå¤§å°ï¼š320Mï¼Ÿ</p>
<p>çœ‹ä¸€ä¸‹gc logä¸­çš„åˆå§‹åŒ–å‚æ•°å§ï¼Œæ‰¾åˆ°gc logçš„æœ€å¼€å¤´ä½ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Memory: 4k page, physical 8010824k(7578720k free), swap 2097148k(1996844k free)</span><br><span class="line">CommandLine flags: -XX:+CMSClassUnloadingEnabled -XX:CMSInitiatingOccupancyFraction=80 -XX:+CMSParallelRemarkEnabled -XX:ConcGCThreads=2 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp/ -XX:InitialHeapSize=7516192768 -XX:+ManagementServer -XX:MaxHeapSize=7516192768 -XX:MaxMetaspaceSize=402653184 -XX:MaxNewSize=348966912 -XX:MetaspaceSize=67108864 -XX:NewSize=348966912 -XX:OldPLABSize=16 -XX:OldSize=697933824 -XX:ParallelGCThreads=4 -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:SurvivorRatio=26 -XX:+UseCMSCompactAtFullCollection -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseConcMarkSweepGC -XX:+UseParNewGC</span><br><span class="line">2018-04-24T23:08:44.044+0800: 7.746: [GC (Allocation Failure) 7.746: [ParNew: 316416K-&gt;12160K(328576K), 0.0890565 secs] 316416K-&gt;24149K(7327872K), 0.0891831 secs] [Times: user=0.15 sys=0.01, real=0.09 secs]</span><br><span class="line">2018-04-24T23:08:48.077+0800: 11.778: [GC (Allocation Failure) 11.778: [ParNew: 328576K-&gt;12159K(328576K), 0.0597998 secs] 340565K-&gt;48432K(7327872K), 0.0598772 secs] [Times: user=0.14 sys=0.01, real=0.06 secs]</span><br><span class="line">2018-04-24T23:08:50.000+0800: 13.702: [GC (Allocation Failure) 13.702: [ParNew: 328575K-&gt;12160K(328576K), 0.0672809 secs] 364848K-&gt;69694K(7327872K), 0.0673553 secs] [Times: user=0.23 sys=0.01, real=0.07 secs]</span><br><span class="line">2018-04-24T23:08:50.742+0800: 14.444: [GC (Allocation Failure) 14.444: [ParNew: 328576K-&gt;12160K(328576K), 0.0572250 secs] 386110K-&gt;101739K(7327872K), 0.0572988 secs] [Times: user=0.13 sys=0.00, real=0.06 secs]</span><br></pre></td></tr></table></figure>
<ol>
<li>å¯åŠ¨å‚æ•°ï¼šNewSizeï¼ŒMaxNewSize 340788K <strong>è¿™ä¹ˆå¤§çš„å †ï¼Œè¿™ä¹ˆå°çš„æ–°ç”Ÿä»£ï¼Ÿ</strong></li>
<li>gc æ—¥å¿—ï¼š</li>
</ol>
<p>[ParNew: 328576K-&gt;12160K(328576K)  ä¸€ä¸ªsurvivoråŒºå ç”¨12160Kï¼Œ328576K=1ä¸ªsurvivor+edenï¼Œsurvivor:eden=2:26 (12160*2):(328576-12160)=2:26  <strong>-XX:SurvivorRatio=26</strong>ä¸ç†è§£è¿™ä¸ªå‚æ•°ä¸ºä½•è¦é…è¿™ä¹ˆå¤š</p>
<ol start="3">
<li><p>-XX:CMSInitiatingOccupancyFraction=80 </p>
<p>é…ç½®äº†å¯åŠ¨çš„æ—¶æœºï¼Œä½†æ˜¯æ²¡æœ‰é…ç½®-XX:+UseCMSInitiatingOccupancyOnlyï¼Œå¯¼è‡´è¿™ä¸ªé…ç½®æˆä¸ºæ‘†è®¾ã€‚</p>
</li>
<li><p>gc logä¸­å‘ç°äº†System.gc</p>
<p>é‚£å°±æŠŠè¿™ä¸ªåŠ ä¸Šï¼š-XX:+DisableExplicitGCï¼Œå¿½ç•¥ç³»ç»Ÿçš„gcè°ƒç”¨ã€‚</p>
</li>
</ol>
<p>æœ€ç»ˆå‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-Xms7G -Xmx7G -Xmn2G </span><br><span class="line">-XX:MetaspaceSize=64M </span><br><span class="line">-XX:MaxMetaspaceSize=384M </span><br><span class="line">-Xloggc:xxx </span><br><span class="line">-verbose:gc </span><br><span class="line">-XX:+PrintGCDateStamps </span><br><span class="line">-XX:+PrintGCDetails </span><br><span class="line">-XX:+UseConcMarkSweepGC </span><br><span class="line">-XX:+UseCMSCompactAtFullCollection </span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=60</span><br><span class="line">-XX:+UseCMSInitiatingOccupancyOnly </span><br><span class="line">-XX:+CMSClassUnloadingEnabled </span><br><span class="line">-XX:+CMSParallelRemarkEnabled</span><br><span class="line">-XX:ParallelGCThreads=4 </span><br><span class="line">-XX:ConcGCThreads=2 </span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError </span><br><span class="line">-XX:HeapDumpPath=/tmp/ </span><br><span class="line">-XX:+DisableExplicitGC</span><br></pre></td></tr></table></figure>
<p>è€ƒè™‘åŠ ä¸Šçš„å‚æ•°ï¼š</p>
<p>CMSFullGCsBeforeCompaction  ï¼šåœ¨ä¸Šä¸€æ¬¡CMSå¹¶å‘GCæ‰§è¡Œè¿‡åï¼Œåˆ°åº•è¿˜è¦å†æ‰§è¡Œå¤šå°‘æ¬¡full GCæ‰ä¼šåšå‹ç¼©ã€‚é»˜è®¤æ˜¯0ï¼Œä¹Ÿå°±æ˜¯åœ¨é»˜è®¤é…ç½®ä¸‹æ¯æ¬¡CMS GCé¡¶ä¸ä½äº†è€Œè¦è½¬å…¥full GCçš„æ—¶å€™éƒ½ä¼šåšå‹ç¼©ã€‚ æŠŠCMSFullGCsBeforeCompactioné…ç½®ä¸º10ï¼Œå°±ä¼šè®©ä¸Šé¢è¯´çš„ç¬¬ä¸€ä¸ªæ¡ä»¶å˜æˆæ¯éš”10æ¬¡çœŸæ­£çš„full GCæ‰åšä¸€æ¬¡å‹ç¼©ï¼ˆ<strong>è€Œä¸æ˜¯æ¯10æ¬¡CMSå¹¶å‘GCå°±åšä¸€æ¬¡å‹ç¼©ï¼Œç›®å‰VMé‡Œæ²¡æœ‰è¿™æ ·çš„å‚æ•°</strong>ï¼‰ã€‚è¿™ä¼šä½¿full GCæ›´å°‘åšå‹ç¼©ï¼Œä¹Ÿå°±æ›´å®¹æ˜“ä½¿CMSçš„old genå—ç¢ç‰‡åŒ–é—®é¢˜çš„å›°æ‰°ã€‚ æœ¬æ¥è¿™ä¸ªå‚æ•°å°±æ˜¯ç”¨æ¥é…ç½®é™ä½full GCå‹ç¼©çš„é¢‘ç‡ï¼Œä»¥æœŸå‡å°‘æŸäº›full GCçš„æš‚åœæ—¶é—´ã€‚CMSå›é€€åˆ°full GCæ—¶ç”¨çš„ç®—æ³•æ˜¯<strong>mark-sweep-compact</strong>ï¼Œä½†compactionæ˜¯å¯é€‰çš„ï¼Œä¸åšçš„è¯ç¢ç‰‡åŒ–ä¼šä¸¥é‡äº›ä½†è¿™æ¬¡full GCçš„æš‚åœæ—¶é—´ä¼šçŸ­äº›ï¼›è¿™æ˜¯ä¸ªå–èˆã€‚</p>
<p>CMSScavengeBeforeRemark : CMSå‰è¿›è¡Œä¸€æ¬¡MinorGC</p>
<p>è°ƒæ•´åå¤§çº¦24h ï¼Œgcæƒ…å†µï¼š</p>
<p><img src="/images/java-tomcat-gc/gc-after-24h.png" alt="gc-after-24h"></p>
<p>å¹³å‡ä¸€ä¸ªå°æ—¶ä¸¤æ¬¡fgcï¼Œæ¯æ¬¡çš„æ—¶é—´ä¸åˆ°0.5sï¼Œå¤§ä½“ä¸Šå¯ä»¥æ¥å—ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li>cmsæµç¨‹</li>
</ol>
<p>   2018-04-28T15:48:13.167+0800: 1341.458: [GC (CMS Initial Mark) [1 CMS-initial-mark: 4076417K(5242880K)] 4093238K(7130368K), 0.0064435 secs] [Times: user=0.01 sys=0.00, real=0.01 secs]</p>
<p>   2018-04-28T15:48:13.173+0800: 1341.465: [CMS-concurrent-mark-start]<br>   2018-04-28T15:48:13.416+0800: 1341.708: [CMS-concurrent-mark: 0.240/0.243 secs] [Times: user=0.88 sys=0.07, real=0.24 secs]</p>
<p>   2018-04-28T15:48:13.416+0800: 1341.708: [CMS-concurrent-preclean-start]</p>
<p>   2018-04-28T15:48:13.436+0800: 1341.728: [CMS-concurrent-preclean: 0.019/0.020 secs] [Times: user=0.07 sys=0.00, real=0.02 secs]</p>
<p>   2018-04-28T15:48:13.436+0800: 1341.728: [CMS-concurrent-abortable-preclean-start]</p>
<p>   2018-04-28T15:48:15.145+0800: 1343.437: [GC (Allocation Failure) 1343.437: [ParNew: 1693259K-&gt;189383K(1887488K), 0.3191849 secs] 5769676K-&gt;4265801K(7130368K), 0.3194583 secs] [Times: user=0.40 sys=0.00, real=0.32 secs]</p>
<p>   2018-04-28T15:48:17.424+0800: 1345.716: [CMS-concurrent-abortable-preclean: 2.845/3.988 secs] [Times: user=10.56 sys=0.64, real=3.99 secs]</p>
<p>   2018-04-28T15:48:17.427+0800: 1345.719: [GC (CMS Final Remark) [YG occupancy: 1685779 K (1887488 K)]1345.719: [Rescan (parallel) , 0.3523662 secs]1346.071: [weak refs processing, 0.3003263 secs]1346.372: [class unloading, 0.1228579 secs]1346.495: [scrub symbol table, 0.0134209 secs]1346.508: [scrub string table, 0.0023638 secs][1 CMS-remark: 4076417K(5242880K)] 5762197K(7130368K), 0.7958359 secs] [Times: user=1.85 sys=0.00, real=0.80 secs]</p>
<p>   2018-04-28T15:48:18.238+0800: 1346.530: [CMS-concurrent-sweep-start]</p>
<p>   2018-04-28T15:48:18.419+0800: 1346.711: [GC (Allocation Failure) 1346.711: [ParNew: 1867207K-&gt;199251K(1887488K), 0.3801573 secs] 5812075K-&gt;4163268K(7130368K), 0.3804263 secs] [Times: user=0.52 sys=0.00, real=0.38 secs]</p>
<p>   2018-04-28T15:48:20.851+0800: 1349.143: [GC (Allocation Failure) 1349.143: [ParNew: 1877075K-&gt;159618K(1887488K), 0.2674537 secs] 3508407K-&gt;1803795K(7130368K), 0.2677172 secs] [Times: user=0.35 sys=0.00, real=0.27 secs]</p>
<p>   2018-04-28T15:48:22.040+0800: 1350.331: [CMS-concurrent-sweep: 3.127/3.801 secs] [Times: user=11.04 sys=0.50, real=3.80secs]</p>
<p>   2018-04-28T15:48:22.040+0800: 1350.331: [CMS-concurrent-reset-start]<br>   2018-04-28T15:48:22.051+0800: 1350.343: [CMS-concurrent-reset: 0.011/0.011 secs] [Times: user=0.04 sys=0.00, real=0.01secs]</p>
<p>   2018-04-28T15:48:22.683+0800: 1350.975: [GC (Allocation Failure) 1350.975: [ParNew: 1837442K-&gt;204471K(1887488K),0.4063115 secs] 2327686K-&gt;697104K(7130368K), 0.4065654 secs] [Times: user=0.47 sys=0.00, real=0.40 secs]</p>
<ul>
<li><p>CMS Initial Mark </p>
<p>åˆå§‹æ ‡è®°ã€‚STWã€‚old sizeï¼š4076417Kï¼Œold capacity:5242880Kï¼Œheap size(ä¸åŒ…æ‹¬perm):4093238K,heap size:7130368K</p>
</li>
<li><p>CMS-concurrent-preclean</p>
</li>
<li><p>CMS Final Remark</p>
<p>æœ€ç»ˆæ ‡è®°ã€‚STWã€‚</p>
<p>[YG occupancy: 1685779 K (1887488 K)]1345.719: [Rescan (parallel) , 0.3523662 secs]1346.071: [weak refs processing, 0.3003263 secs]1346.372: [class unloading, 0.1228579 secs]1346.495: [scrub symbol table, 0.0134209 secs]1346.508: [scrub string table, 0.0023638 secs][1 CMS-remark: 4076417K(5242880K)] 5762197K(7130368K), 0.7958359 secs] [Times: user=1.85 sys=0.00, real=0.80 secs]</p>
<p>young size:1685779K</p>
<p>young capacity:1887488 K</p>
<p>heap size:5762197K</p>
<p>heap capacity:7130368K</p>
</li>
<li><p>åˆ†æä¸€ä¸‹CMS-concurrent-sweep-start ä»¥åçš„å‡ æ¬¡ParNewï¼š</p>
</li>
</ul>
<pre><code>| æ¬¡æ•° | young size before MinorGC | young size after MinorGC | heap size before MinorGC | heap size after MinorGC |
| ---- | ------------------------- | ------------------------ | ------------------------ | ----------------------- |
| 1    | 1867207K                  | 199251K                  | 5812075K                 | 4163268K                |
| 2    | 1877075K                  | 159618K                  | 3508407K                 | 1803795K                |
| 3    | 1837442K                  | 204471K                  | 2327686K                 | 697104K                 |
</code></pre><p>â€‹     ä»è¡¨æ ¼ä¸­è®¡ç®—ï¼Œcmså‰åï¼Œold sizeï¼šä»4163268K-199251K  å¤§çº¦å°†ä¸º697104K-204471Kã€‚</p>
<ol start="2">
<li><p>cmså‚æ•°è°ƒæ•´æ€ä¹ˆç®—ä¼˜ç§€ï¼Ÿ</p>
<p>æ ‡å‡†ï¼šä»¥å¯¹è±¡ä»æ–°ç”Ÿä»£æå‡åˆ°è€å¹´ä»£çš„é€Ÿåº¦å¯¹è€å¹´ä»£ä¸­çš„å¯¹è±¡è¿›è¡Œæ”¶é›†ã€‚</p>
<p>è¾¾ä¸åˆ°è¿™ä¸ªæ ‡å‡†åˆ™ç§°ä¹‹ä¸ºå¤±é€Ÿ(Lost the Race)ã€‚å¤±é€Ÿä¼šå¯¼è‡´Stop-The-World å‹ç¼©å¼åƒåœ¾æ”¶é›†(å•çº¿ç¨‹çš„Serial Old FullGC)ã€‚é¿å…å¤±é€Ÿçš„å…³é”®æ˜¯è¦ç»“åˆè¶³å¤Ÿå¤§çš„è€å¹´ä»£å’Œè¶³å¤Ÿå¿«åœ°åˆå§‹åŒ–CMSåƒåœ¾æ”¶é›†å‘¨æœŸï¼Œè®©å®ƒä»¥æ¯”æå‡é€Ÿç‡æ›´å¿«çš„é€Ÿåº¦å›æ”¶ç©ºé—´ã€‚</p>
</li>
<li><p>concurrent mode failure</p>
<ul>
<li>å½“CMS GCè¿›è¡Œè¿‡ç¨‹ä¸­ï¼ŒMinor GCå‘è€å¹´ä»£æå‡çš„é€Ÿåº¦å¿«äºæ”¶é›†å™¨æ”¶é›†çš„é€Ÿåº¦ã€‚</li>
<li>CMS å’ŒMinorGCåŒæ—¶è¿›è¡Œæ—¶ï¼Œæ–°ç”Ÿä»£Survivorç©ºé—´æ”¾ä¸ä¸‹ï¼Œéœ€è¦æå‡åˆ°è€å¹´ä»£ã€‚</li>
<li>CMSè¿›è¡Œæ—¶ï¼Œä¸šåŠ¡å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œè€å¹´ä»£æ”¾ä¸ä¸‹ã€‚</li>
</ul>
<p>ä¸Šè¿°ä¸‰ç§ä¼šå¯¼è‡´è¯¥ç°è±¡å‘ç”Ÿã€‚</p>
</li>
</ol>
<p>   å‘ç”Ÿå‹ç¼©å¼åƒåœ¾æ”¶é›†æ—¶ï¼Œcms gc logä¼šå‡ºç°å¹¶å‘æ¨¡å¼å¤±æ•ˆ(Concurrent Mode Failure)æ—¥å¿—ï¼š</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018-04-30T08:27:57.376+0800: 147363.218: [GC (Allocation Failure) 147363.223: [ParNew: 2831168K-&gt;2831168K(2831168K), 0.0018961 secs]147363.225: [CMS2018-04-30T08:28:01.910+0800: 147367.747: [CMS-concurrent-sweep: 45.882/77.866 secs] [Times: user=138.72 sys=18.07, real=77.88 secs](concurrent mode failure): 4045869K-&gt;745862K(4194304K), 38.8136017 secs] 6877037K-&gt;745862K(7025472K), [Metaspace: 125954K-&gt;125954K(1167360K)], 38.8679322 secs] [Times: user=4.18 sys=1.47, real=38.86 secs]</span><br></pre></td></tr></table></figure>
<p>   MinorGC å‰åï¼šyoung sizeéƒ½æ˜¯2831168K ï¼Œè¯´æ˜MinorGCæ”¶é›†ä¸äº†ï¼Œè€Œcmså¯åŠ¨æ—¶ï¼ŒoldåŒºçš„å¯ç”¨ç©ºé—´ä¸º5G*30%ï¼Œæ”¾ä¸ä¸‹youngç©ºé—´çš„æ•°æ®ï¼Œå¯¼è‡´STWï¼Œç„¶åè½¬åŒ–ä¸ºå•çº¿ç¨‹çš„FullGCã€‚ä¾‹å­ä¸­FullGCè€—æ—¶38.86sã€‚</p>
<ol start="4">
<li><p>promotion failed</p>
<p>MinorGCæ—¶ï¼ŒSruvivor spaceæ”¾ä¸ä¸‹ï¼Œåªèƒ½æ”¾åˆ°è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹ï¼Œæ­¤æ—¶ä¼šå¯¼è‡´STW ä½¿ç”¨Serial Oldæ”¶é›†å™¨è¿›è¡ŒFull GC.</p>
</li>
</ol>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="http://itindex.net/detail/47030-cms-gc-%E9%97%AE%E9%A2%98" target="_blank" rel="noopener">http://itindex.net/detail/47030-cms-gc-%E9%97%AE%E9%A2%98</a></p>
<p><a href="http://www.oracle.com/technetwork/java/javase/tech/index.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/tech/index.html</a></p>
<p><a href="http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html</a></p>
<p><a href="https://www.jianshu.com/p/ca1b0d4107c5" target="_blank" rel="noopener">https://www.jianshu.com/p/ca1b0d4107c5</a></p>

        
      </div>
      <footer>
        
          
  
  <div class="categories">
    <a href="/categories/java/">java</a>
  </div>

          
          <div class="share">
  

    

    

    
      <div class="g-plusone"></div>
      <span style="margin-right:10px"></span>

      <script type="text/javascript">
        window.___gcfg = {lang: 'en-GB'};

        (function() {
          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
          po.src = 'https://apis.google.com/js/platform.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
      </script>
    

    
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="halfer53">Tweet</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    
  
</div>
          
<nav class="article-nav clearfix">
 
 <div class="article-prev" >
 <a href="/2018/05/03/java/gcåŸºç¡€/" title="">
  <i class="fa fa-long-arrow-left"></i>
  <span>
  (no title)</span>
</a>
</div>


<div class="article-next">
<a href="/2018/04/17/zookeeper/zookeeper/"  title="zookeeperæ³¨æ„ç‚¹">
 <span>zookeeperæ³¨æ„ç‚¹
</span>
<i class="fa fa-long-arrow-right"></i>
</a>
</div>

</nav>

        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>


<section id="comment">
  <h2 class="title">Comments</h2>

  
</section>

</div></div>
    <aside id="sidebar" class="alignright"><div class="padding">
	
	  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:unei.me">
  </form>
</div>
	
	  
<div class="widget recent-post">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2018/05/10/os/å†…å­˜/">å†…å­˜</a>
      </li>
    
      <li>
        <a href="/2018/05/04/java/ParallelScavengeå’ŒParNew/"></a>
      </li>
    
      <li>
        <a href="/2018/05/03/java/gcåŸºç¡€/"></a>
      </li>
    
      <li>
        <a href="/2018/04/26/java/tomcatå¼‚å¸¸åˆ†æ/">tomcatå¼‚å¸¸åˆ†æ</a>
      </li>
    
      <li>
        <a href="/2018/04/17/zookeeper/zookeeper/">zookeeperæ³¨æ„ç‚¹</a>
      </li>
    
  </ul>
</div>

	
	  
<div class="widget category">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/books/">books</a><small>1</small></li>
  
    <li><a href="/categories/git/">git</a><small>1</small></li>
  
    <li><a href="/categories/golang/">golang</a><small>4</small></li>
  
    <li><a href="/categories/hystrix/">hystrix</a><small>2</small></li>
  
    <li><a href="/categories/java/">java</a><small>6</small></li>
  
    <li><a href="/categories/kafka/">kafka</a><small>3</small></li>
  
    <li><a href="/categories/linux/">linux</a><small>3</small></li>
  
    <li><a href="/categories/mysql/">mysql</a><small>1</small></li>
  
    <li><a href="/categories/network/">network</a><small>7</small></li>
  
    <li><a href="/categories/os/">os</a><small>1</small></li>
  
    <li><a href="/categories/redis/">redis</a><small>1</small></li>
  
    <li><a href="/categories/ruby/">ruby</a><small>2</small></li>
  
    <li><a href="/categories/spring/">spring</a><small>3</small></li>
  
    <li><a href="/categories/zookeeper/">zookeeper</a><small>1</small></li>
  
    <li><a href="/categories/æ€»ç»“/">æ€»ç»“</a><small>1</small></li>
  
  </ul>
</div>

	
	  
	
</div></aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="padding">
	<div class="alignleft">
	  
	  &copy; 2018 hello world
	  
	  Powerd by <a href="http://hexo.io/" target="_blank">hexo</a>
	  and Theme by <a href="https://github.com/halfer53/metro-light" target="_blank">metro-light</a>
	</div>

	<div class="alignright">
		
		
		
		
		
		
		
	</div>

	<div class="clearfix"></div>
</div>

<div class="scroll-top"><i class="fa fa-arrow-circle-up"></i></div></footer>
  


<link href='http://apps.bdimg.com/libs/fontawesome/4.1.0/css/font-awesome.css' rel='stylesheet' type='text/css'>
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>



<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.0.4/jquery.imagesloaded.js"></script> -->
<!-- <script src="/js/gallery.js"></script> -->



<script type="text/javascript">
$(window).scroll(function() {

    if($(this).scrollTop() > 400) {
        $('.scroll-top').fadeIn(200);
    } else {
        $('.scroll-top').fadeOut(200);
    }
});

$('.scroll-top').bind('click', function(e) {
    e.preventDefault();
    $('body,html').animate({scrollTop:0},200);
});
</script>


</body>
</html>
