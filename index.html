<!DOCTYPE HTML>

    <html lang="zh-Hans">
  
<head>
  <meta charset="utf-8">
  
  <title>Hello World</title>
  <meta name="author" content="hello world">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Hello World"/>

  
    <meta property="og:image" content=""/>
  

  
    <meta http-equiv="Content-Language" content="zh-Hans"/>
  

  <link href="/img/favicon.png" rel="icon">
  
    <link rel="apple-touch-icon" href="/img/apple-icon.png">
    <link rel="apple-touch-icon-precomposed" href="/img/apple-icon.png">
    

  <link rel="alternate" href="/atom.xml" title="Hello World" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
  <style type="text/css">
  /* Tim Pietrusky advanced checkbox hack (Android <= 4.1.2) */
body{ -webkit-animation: bugfix infinite 1s; }
@-webkit-keyframes bugfix { from {padding:0;} to {padding:0;} }

  
  <!-- Chinese readability improvements -->
    article {font-weight: 400;letter-spacing: .01rem;}
    article .entry{line-height:2;}
  

  
    article .post-content-index .entry{max-height: 550px; overflow:hidden;}
  
</style>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
 
</script>




  
  
</head>


<body>
  <header id="header" class="inner"><div class="padding">
	<div class="alignleft logo">
	  <h1><a href="/">Hello World</a></h1>
	</div>
	<nav id="main-nav" class="alignright">
		<input type="checkbox" id="toggle" />
		<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu" onclick><i class="fa fa-bars"></i></label>
	  <ul class="menu">
	    
	      <li><a href="/">Home</a></li>
	    
	      <li><a href="/archives">Archives</a></li>
	    
	    
	  </ul>
	</nav>
	<div class="clearfix"></div>
</div>
</header>
  <div id="page-heading-wrap">
  	<div class="inner">
      <div class="padding">
    		
          <h2></h2>
        
      </div>
  	</div>
  </div>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper" class="padding">
  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/05/10/os/å†…å­˜/">å†…å­˜</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-05-09T16:00:00.000Z">2018-05-10</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <p>test</p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/05/10/os/å†…å­˜/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/05/04/java/ParallelScavengeå’ŒParNew/"></a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-05-04T02:29:11.504Z">2018-05-04</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <p>ParallelScavengeå’ŒParNewéƒ½æ˜¯å¹¶è¡ŒGCï¼Œä¸»è¦æ˜¯å¹¶è¡Œæ”¶é›†young genï¼Œç›®çš„å’Œæ€§èƒ½å…¶å®éƒ½å·®ä¸å¤šã€‚æœ€æ˜æ˜¾çš„åŒºåˆ«æœ‰ä¸‹é¢å‡ ç‚¹ï¼š  </p>
<p>1ã€PSä»¥å‰æ˜¯å¹¿åº¦ä¼˜å…ˆé¡ºåºæ¥éå†å¯¹è±¡å›¾çš„ï¼ŒJDK6çš„æ—¶å€™æ”¹ä¸ºé»˜è®¤ç”¨æ·±åº¦ä¼˜å…ˆé¡ºåºéå†ï¼Œå¹¶ç•™æœ‰ä¸€ä¸ªUseDepthFirstScavengeOrderå‚æ•°æ¥é€‰æ‹©æ˜¯ç”¨æ·±åº¦è¿˜æ˜¯å¹¿åº¦ä¼˜å…ˆã€‚åœ¨JDK6u18ä¹‹åè¿™ä¸ªå‚æ•°è¢«å»æ‰ï¼ŒPSå˜ä¸ºåªç”¨æ·±åº¦ä¼˜å…ˆéå†ã€‚ParNewåˆ™æ˜¯ä¸€ç›´éƒ½åªç”¨å¹¿åº¦ä¼˜å…ˆé¡ºåºæ¥éå† </p>
<p> 2ã€PSå®Œæ•´å®ç°äº†adaptive size policyï¼Œè€ŒParNewåŠâ€œåˆ†ä»£å¼GCæ¡†æ¶â€å†…çš„å…¶å®ƒGCéƒ½æ²¡æœ‰å®ç°<strong>å®Œ</strong>ï¼ˆå€’ä¸æ˜¯ä¸èƒ½å®ç°ï¼Œå°±æ˜¯éº»çƒ¦+æ²¡äººåŠ›èµ„æºå»åšï¼‰ã€‚æ‰€ä»¥åƒä¸‡åƒä¸‡åˆ«åœ¨ç”¨ParNew+CMSçš„ç»„åˆä¸‹ç”¨UseAdaptiveSizePolicyï¼Œè¯·åªåœ¨ä½¿ç”¨UseParallelGCæˆ–UseParallelOldGCçš„æ—¶å€™ç”¨å®ƒã€‚  </p>
<p>3ã€ç”±äºåœ¨â€œåˆ†ä»£å¼GCæ¡†æ¶â€å†…ï¼ŒParNewå¯ä»¥è·ŸCMSæ­é…ä½¿ç”¨ï¼Œè€ŒParallelScavengeä¸èƒ½ã€‚å½“æ—¶ParNew GCè¢«ä»Exact VMç§»æ¤åˆ°HotSpot VMçš„æœ€å¤§åŸå› å°±æ˜¯ä¸ºäº†è·ŸCMSæ­é…ä½¿ç”¨ã€‚  </p>
<p>4ã€åœ¨PSæˆä¸ºä¸»è¦çš„throughput GCä¹‹åï¼Œå®ƒè¿˜å®ç°äº†é’ˆå¯¹NUMAçš„ä¼˜åŒ–ï¼›è€ŒParNewä¸€ç›´æ²¡æœ‰å¾—åˆ°NUMAä¼˜åŒ–çš„å®ç°ã€‚ </p>
<p>from: <a href="http://hllvm.group.iteye.com/group/topic/37095#post-242695" target="_blank" rel="noopener">http://hllvm.group.iteye.com/group/topic/37095#post-242695</a></p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/05/04/java/ParallelScavengeå’ŒParNew/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/05/03/java/gcåŸºç¡€/"></a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-05-03T15:06:47.917Z">2018-05-03</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h3 id="åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»"><a href="#åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»" class="headerlink" title="åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»"></a>åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»</h3><ol>
<li><p>å¼•ç”¨è®¡æ•°æ³• Reference Counting</p>
</li>
<li><p>å¯è¾¾æ€§åˆ†ææ³•</p>
<p>é€šè¿‡GC Rootså‘ä¸‹æœç´¢ï¼Œæœç´¢ä¸åˆ°çš„éƒ½å¯ä»¥å›æ”¶ã€‚</p>
<ul>
<li>GC Roots<ul>
<li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h3><table>
<thead>
<tr>
<th>ç®—æ³•</th>
<th>æµç¨‹</th>
<th>å›¾ç¤º</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ ‡è®°-æ¸…é™¤ç®—æ³• Mark-Sweep</td>
<td>1. æ ‡è®°æ— ç”¨å¯¹è±¡<br>2. æ¸…é™¤</td>
<td></td>
<td></td>
<td>1. ä¸¤ä¸ªè¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜<br>2.ç©ºé—´é—®é¢˜ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</td>
</tr>
<tr>
<td>å¤åˆ¶ç®—æ³• Copying</td>
<td>å°†å†…å­˜åˆ†ä¸ºç›¸ç­‰çš„ä¸¤å—ï¼Œå½“ä¸€å—ç”¨å®Œï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œç„¶åå°†å·²ä½¿ç”¨çš„ä¸€æ¬¡æ€§æ¸…ç†</td>
<td></td>
<td>é€Ÿåº¦å¿«</td>
<td>ç©ºé—´åˆ©ç”¨ç‡ä½</td>
</tr>
<tr>
<td>æ ‡è®°-æ•´ç†ç®—æ³• Mark-Compact</td>
<td>1.æ ‡è®°æ— ç”¨å¯¹è±¡<br>2.è®©å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œæœ€åæ¸…ç†æ‰è¾¹ç•Œå¤–çš„å†…å­˜</td>
<td></td>
<td>æ— å†…å­˜ç¢ç‰‡</td>
<td>é€Ÿåº¦æ…¢</td>
</tr>
<tr>
<td>åˆ†ä»£æ”¶é›†ç®—æ³• Generational Collection</td>
<td>æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ†ä¸ºå‡ å—ï¼Œæ¯å—é‡‡å–ä¸åŒçš„ç®—æ³•</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol>
<li><p>ä»€ä¹ˆæ˜¯å†…å­˜æ‹…ä¿ï¼Ÿ</p>
<p>å¦‚æœå¦ä¸€å—Survivoræ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾ä¸Šä¸€æ¬¡æ–°ç”Ÿä»£æ”¶é›†ä¸‹æ¥çš„å­˜æ´»å¯¹è±¡æ—¶ï¼Œè¿™äº›å¯¹è±¡å°†ç›´æ¥é€šè¿‡åˆ†é…æ‹…ä¿æœºåˆ¶è¿›å…¥è€å¹´ä»£ã€‚</p>
</li>
</ol>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/05/03/java/gcåŸºç¡€/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/04/26/java/tomcatå¼‚å¸¸åˆ†æ/">tomcatå¼‚å¸¸åˆ†æ</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-04-25T16:00:00.000Z">2018-04-26</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h3 id="å‘ç°"><a href="#å‘ç°" class="headerlink" title="å‘ç°"></a>å‘ç°</h3><p>åŠä¸ªæœˆå‰å‘ç°ï¼Œé‚®ä»¶æŠ¥è­¦ï¼Œçº¿ä¸Šçš„tomcatä¸€ç›´åœ¨æŠ¥ç›‘æ§æ¥å£è¶…æ—¶ï¼Œè¿™ä¸ªç›‘æ§æ¥å£å°±æ˜¯è¿”å›ä¸ªhello world,æ²¡æœ‰ä¾èµ–å…¶ä»–ç³»ç»Ÿã€‚è¿™ä¸ªæŠ¥è­¦ï¼Œå¤§çº¦å‡ ä¸ªå°æ—¶æ¥ä¸€æ¬¡ã€‚</p>
<h3 id="çº¿ä¸Šç›‘æ§"><a href="#çº¿ä¸Šç›‘æ§" class="headerlink" title="çº¿ä¸Šç›‘æ§"></a>çº¿ä¸Šç›‘æ§</h3><ol>
<li><p>ç›‘æ§æ¥å£è¯·æ±‚è€—æ—¶ç›‘æ§</p>
<p><img src="/images/java-tomcat-gc/image003.png" alt="image003"></p>
</li>
</ol>
<ol start="2">
<li><p>ç½‘ç»œç›‘æ§</p>
<p><img src="/images/java-tomcat-gc/image001.png" alt="image001"></p>
</li>
</ol>
<ol start="3">
<li><p>cpuç›‘æ§</p>
<p><img src="/images/java-tomcat-gc/image002.png" alt="image002"></p>
</li>
<li><p>jstat</p>
<p><img src="/images/java-tomcat-gc/gcutil.png" alt="gcutil"></p>
</li>
</ol>
<h3 id="æ¨æ–­"><a href="#æ¨æ–­" class="headerlink" title="æ¨æ–­"></a>æ¨æ–­</h3><p>ä»ä¸Šé¢ä¸‰ä¸ªå¯ä»¥çœ‹å‡ºï¼Œæœºå™¨æ²¡æ­»ï¼Œæ´»ç€å‘¢ï¼Œç½‘ç»œåœæ­¢äº†ï¼Œä¼°è®¡jvmåœ¨gcï¼ˆæœ€åè¯å®ç¡®å®å¦‚æ­¤ï¼‰ã€‚</p>
<h3 id="ä¼˜åŒ–æ€è·¯"><a href="#ä¼˜åŒ–æ€è·¯" class="headerlink" title="ä¼˜åŒ–æ€è·¯"></a>ä¼˜åŒ–æ€è·¯</h3><p>çœ‹ä¸€ä¸‹åŸå§‹çš„jvmå‚æ•°ï¼ˆè¿™ä¸ªå‚æ•°ä¸æ˜¯æˆ‘é…çš„ğŸ˜‚ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseCompressedOops -Xms7G -Xmx7G -XX:MetaspaceSize=64M -XX:+MaxMetaspaceSize=384M -Xloggc:path/log.log -verbose:gc  -XX:HeapDumpPath=/tmp -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+UseConcMarkSweepGC -XX:+UseCMSCompactAtFullCollection -XX:+CMSClassUnloadingEnabled -XX:ParallelGCThreads=4 -XX:ConcGCThreads=2 -XX:+HeapDumpOnOutOfMemoryError -XX:SurvivorRatio=26 -XX:+CMSParallelRemarkEnabled -XX:CMSInitiatingOccupancyFraction=80</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œæˆ‘éœ€è¦çœ‹ä¸€ä¸‹gc logï¼Œç»“æœè¿ç»´æ‰¾ä¸åˆ°æ—¥å¿—ï¼Œå°´å°¬ï¼Œç›¸å¯¹è·¯å¾„ï¼Œæ—¥å¿—å°±æ²¡è¾“å‡ºã€‚ç¬¬äºŒï¼Œæˆ‘è¦çœ‹ä¸€ä¸‹fgcå‰åçš„å †å˜åŒ–æƒ…å†µï¼Œç„¶åå°±åŠ äº†ä¸‹é¢çš„å‚æ•°ï¼š</p>
<p>-XX:+HeapDumpBeforeFullGC -XX:+HeadDumpAfterFullGC</p>
<p>è¿™ä¿©ä¸œè¥¿å°±ä¸€èµ·æåˆ°çº¿ä¸Šå»äº†ã€‚</p>
<p>ç„¶åã€‚ã€‚ã€‚ç­‰å¾…é—®é¢˜å¤ç°ã€‚</p>
<p>æŠ“åˆ°äº†ï¼Œçœ‹gclogï¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2018-04-25T09:58:55.273+0800: 39018.975: [GC (Allocation Failure) 39018.976: [ParNew (promotion failed): 328576K-&gt;328576K(328576K), 0.2897109 secs]39019.266: [CMS2018-04-25T09:59:37.021+0800: 39060.736: [CMS-concurrent-sweep: 61.437/80.407 secs] [Times: user=85.18 sys=9.30, real=80.42 secs]</span><br><span class="line"> (concurrent mode failure): 5754419K-&gt;709193K(6999296K), 93.9618683 secs] 6066058K-&gt;709193K(7327872K), [Metaspace: 125046K-&gt;125046K(1167360K)], 94.2613781 secs] [Times: user=8.22 sys=3.47, real=94.26 secs]</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™é‡Œï¼Œå°±å‘ç°é—®é¢˜ä¸å¯¹åŠ²äº†ï¼Œconcurrent mode failureï¼Œreal 80.42, 94.26ã€‚</p>
<p>å…¶å®åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘æ²¡ä»”ç»†ç®—gcå‰åçš„heapå¤§å°ï¼Œåˆå»çœ‹äº†ä¸€ä¸‹heap dumpï¼Œdumpä¹Ÿæ²¡çœ‹å‡ºæ¥å•¥ï¼Œä½†æ˜¯ï¼Œfgcå‰åçš„æ–‡ä»¶å¤§å°å·®è·å°±å¤§äº†ï¼Œä¸€ä¸ª6.5gï¼Œä¸€ä¸ª600mã€‚è¿™ä¸ªæé†’æˆ‘å»çœ‹ä¸€ä¸‹gc logã€‚</p>
<p>youngå¤§å°ï¼š320Mï¼Ÿ</p>
<p>çœ‹ä¸€ä¸‹gc logä¸­çš„åˆå§‹åŒ–å‚æ•°å§ï¼Œæ‰¾åˆ°gc logçš„æœ€å¼€å¤´ä½ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Memory: 4k page, physical 8010824k(7578720k free), swap 2097148k(1996844k free)</span><br><span class="line">CommandLine flags: -XX:+CMSClassUnloadingEnabled -XX:CMSInitiatingOccupancyFraction=80 -XX:+CMSParallelRemarkEnabled -XX:ConcGCThreads=2 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp/ -XX:InitialHeapSize=7516192768 -XX:+ManagementServer -XX:MaxHeapSize=7516192768 -XX:MaxMetaspaceSize=402653184 -XX:MaxNewSize=348966912 -XX:MetaspaceSize=67108864 -XX:NewSize=348966912 -XX:OldPLABSize=16 -XX:OldSize=697933824 -XX:ParallelGCThreads=4 -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:SurvivorRatio=26 -XX:+UseCMSCompactAtFullCollection -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseConcMarkSweepGC -XX:+UseParNewGC</span><br><span class="line">2018-04-24T23:08:44.044+0800: 7.746: [GC (Allocation Failure) 7.746: [ParNew: 316416K-&gt;12160K(328576K), 0.0890565 secs] 316416K-&gt;24149K(7327872K), 0.0891831 secs] [Times: user=0.15 sys=0.01, real=0.09 secs]</span><br><span class="line">2018-04-24T23:08:48.077+0800: 11.778: [GC (Allocation Failure) 11.778: [ParNew: 328576K-&gt;12159K(328576K), 0.0597998 secs] 340565K-&gt;48432K(7327872K), 0.0598772 secs] [Times: user=0.14 sys=0.01, real=0.06 secs]</span><br><span class="line">2018-04-24T23:08:50.000+0800: 13.702: [GC (Allocation Failure) 13.702: [ParNew: 328575K-&gt;12160K(328576K), 0.0672809 secs] 364848K-&gt;69694K(7327872K), 0.0673553 secs] [Times: user=0.23 sys=0.01, real=0.07 secs]</span><br><span class="line">2018-04-24T23:08:50.742+0800: 14.444: [GC (Allocation Failure) 14.444: [ParNew: 328576K-&gt;12160K(328576K), 0.0572250 secs] 386110K-&gt;101739K(7327872K), 0.0572988 secs] [Times: user=0.13 sys=0.00, real=0.06 secs]</span><br></pre></td></tr></table></figure>
<ol>
<li>å¯åŠ¨å‚æ•°ï¼šNewSizeï¼ŒMaxNewSize 340788K <strong>è¿™ä¹ˆå¤§çš„å †ï¼Œè¿™ä¹ˆå°çš„æ–°ç”Ÿä»£ï¼Ÿ</strong></li>
<li>gc æ—¥å¿—ï¼š</li>
</ol>
<p>[ParNew: 328576K-&gt;12160K(328576K)  ä¸€ä¸ªsurvivoråŒºå ç”¨12160Kï¼Œ328576K=1ä¸ªsurvivor+edenï¼Œsurvivor:eden=2:26 (12160*2):(328576-12160)=2:26  <strong>-XX:SurvivorRatio=26</strong>ä¸ç†è§£è¿™ä¸ªå‚æ•°ä¸ºä½•è¦é…è¿™ä¹ˆå¤š</p>
<ol start="3">
<li><p>-XX:CMSInitiatingOccupancyFraction=80 </p>
<p>é…ç½®äº†å¯åŠ¨çš„æ—¶æœºï¼Œä½†æ˜¯æ²¡æœ‰é…ç½®-XX:+UseCMSInitiatingOccupancyOnlyï¼Œå¯¼è‡´è¿™ä¸ªé…ç½®æˆä¸ºæ‘†è®¾ã€‚</p>
</li>
<li><p>gc logä¸­å‘ç°äº†System.gc</p>
<p>é‚£å°±æŠŠè¿™ä¸ªåŠ ä¸Šï¼š-XX:+DisableExplicitGCï¼Œå¿½ç•¥ç³»ç»Ÿçš„gcè°ƒç”¨ã€‚</p>
</li>
</ol>
<p>æœ€ç»ˆå‚æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-Xms7G -Xmx7G -Xmn2G </span><br><span class="line">-XX:MetaspaceSize=64M </span><br><span class="line">-XX:MaxMetaspaceSize=384M </span><br><span class="line">-Xloggc:xxx </span><br><span class="line">-verbose:gc </span><br><span class="line">-XX:+PrintGCDateStamps </span><br><span class="line">-XX:+PrintGCDetails </span><br><span class="line">-XX:+UseConcMarkSweepGC </span><br><span class="line">-XX:+UseCMSCompactAtFullCollection </span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=60</span><br><span class="line">-XX:+UseCMSInitiatingOccupancyOnly </span><br><span class="line">-XX:+CMSClassUnloadingEnabled </span><br><span class="line">-XX:+CMSParallelRemarkEnabled</span><br><span class="line">-XX:ParallelGCThreads=4 </span><br><span class="line">-XX:ConcGCThreads=2 </span><br><span class="line">-XX:+HeapDumpOnOutOfMemoryError </span><br><span class="line">-XX:HeapDumpPath=/tmp/ </span><br><span class="line">-XX:+DisableExplicitGC</span><br></pre></td></tr></table></figure>
<p>è€ƒè™‘åŠ ä¸Šçš„å‚æ•°ï¼š</p>
<p>CMSFullGCsBeforeCompaction  ï¼šåœ¨ä¸Šä¸€æ¬¡CMSå¹¶å‘GCæ‰§è¡Œè¿‡åï¼Œåˆ°åº•è¿˜è¦å†æ‰§è¡Œå¤šå°‘æ¬¡full GCæ‰ä¼šåšå‹ç¼©ã€‚é»˜è®¤æ˜¯0ï¼Œä¹Ÿå°±æ˜¯åœ¨é»˜è®¤é…ç½®ä¸‹æ¯æ¬¡CMS GCé¡¶ä¸ä½äº†è€Œè¦è½¬å…¥full GCçš„æ—¶å€™éƒ½ä¼šåšå‹ç¼©ã€‚ æŠŠCMSFullGCsBeforeCompactioné…ç½®ä¸º10ï¼Œå°±ä¼šè®©ä¸Šé¢è¯´çš„ç¬¬ä¸€ä¸ªæ¡ä»¶å˜æˆæ¯éš”10æ¬¡çœŸæ­£çš„full GCæ‰åšä¸€æ¬¡å‹ç¼©ï¼ˆ<strong>è€Œä¸æ˜¯æ¯10æ¬¡CMSå¹¶å‘GCå°±åšä¸€æ¬¡å‹ç¼©ï¼Œç›®å‰VMé‡Œæ²¡æœ‰è¿™æ ·çš„å‚æ•°</strong>ï¼‰ã€‚è¿™ä¼šä½¿full GCæ›´å°‘åšå‹ç¼©ï¼Œä¹Ÿå°±æ›´å®¹æ˜“ä½¿CMSçš„old genå—ç¢ç‰‡åŒ–é—®é¢˜çš„å›°æ‰°ã€‚ æœ¬æ¥è¿™ä¸ªå‚æ•°å°±æ˜¯ç”¨æ¥é…ç½®é™ä½full GCå‹ç¼©çš„é¢‘ç‡ï¼Œä»¥æœŸå‡å°‘æŸäº›full GCçš„æš‚åœæ—¶é—´ã€‚CMSå›é€€åˆ°full GCæ—¶ç”¨çš„ç®—æ³•æ˜¯<strong>mark-sweep-compact</strong>ï¼Œä½†compactionæ˜¯å¯é€‰çš„ï¼Œä¸åšçš„è¯ç¢ç‰‡åŒ–ä¼šä¸¥é‡äº›ä½†è¿™æ¬¡full GCçš„æš‚åœæ—¶é—´ä¼šçŸ­äº›ï¼›è¿™æ˜¯ä¸ªå–èˆã€‚</p>
<p>CMSScavengeBeforeRemark : CMSå‰è¿›è¡Œä¸€æ¬¡MinorGC</p>
<p>è°ƒæ•´åå¤§çº¦24h ï¼Œgcæƒ…å†µï¼š</p>
<p><img src="/images/java-tomcat-gc/gc-after-24h.png" alt="gc-after-24h"></p>
<p>å¹³å‡ä¸€ä¸ªå°æ—¶ä¸¤æ¬¡fgcï¼Œæ¯æ¬¡çš„æ—¶é—´ä¸åˆ°0.5sï¼Œå¤§ä½“ä¸Šå¯ä»¥æ¥å—ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol>
<li>cmsæµç¨‹</li>
</ol>
<p>   2018-04-28T15:48:13.167+0800: 1341.458: [GC (CMS Initial Mark) [1 CMS-initial-mark: 4076417K(5242880K)] 4093238K(7130368K), 0.0064435 secs] [Times: user=0.01 sys=0.00, real=0.01 secs]</p>
<p>   2018-04-28T15:48:13.173+0800: 1341.465: [CMS-concurrent-mark-start]<br>   2018-04-28T15:48:13.416+0800: 1341.708: [CMS-concurrent-mark: 0.240/0.243 secs] [Times: user=0.88 sys=0.07, real=0.24 secs]</p>
<p>   2018-04-28T15:48:13.416+0800: 1341.708: [CMS-concurrent-preclean-start]</p>
<p>   2018-04-28T15:48:13.436+0800: 1341.728: [CMS-concurrent-preclean: 0.019/0.020 secs] [Times: user=0.07 sys=0.00, real=0.02 secs]</p>
<p>   2018-04-28T15:48:13.436+0800: 1341.728: [CMS-concurrent-abortable-preclean-start]</p>
<p>   2018-04-28T15:48:15.145+0800: 1343.437: [GC (Allocation Failure) 1343.437: [ParNew: 1693259K-&gt;189383K(1887488K), 0.3191849 secs] 5769676K-&gt;4265801K(7130368K), 0.3194583 secs] [Times: user=0.40 sys=0.00, real=0.32 secs]</p>
<p>   2018-04-28T15:48:17.424+0800: 1345.716: [CMS-concurrent-abortable-preclean: 2.845/3.988 secs] [Times: user=10.56 sys=0.64, real=3.99 secs]</p>
<p>   2018-04-28T15:48:17.427+0800: 1345.719: [GC (CMS Final Remark) [YG occupancy: 1685779 K (1887488 K)]1345.719: [Rescan (parallel) , 0.3523662 secs]1346.071: [weak refs processing, 0.3003263 secs]1346.372: [class unloading, 0.1228579 secs]1346.495: [scrub symbol table, 0.0134209 secs]1346.508: [scrub string table, 0.0023638 secs][1 CMS-remark: 4076417K(5242880K)] 5762197K(7130368K), 0.7958359 secs] [Times: user=1.85 sys=0.00, real=0.80 secs]</p>
<p>   2018-04-28T15:48:18.238+0800: 1346.530: [CMS-concurrent-sweep-start]</p>
<p>   2018-04-28T15:48:18.419+0800: 1346.711: [GC (Allocation Failure) 1346.711: [ParNew: 1867207K-&gt;199251K(1887488K), 0.3801573 secs] 5812075K-&gt;4163268K(7130368K), 0.3804263 secs] [Times: user=0.52 sys=0.00, real=0.38 secs]</p>
<p>   2018-04-28T15:48:20.851+0800: 1349.143: [GC (Allocation Failure) 1349.143: [ParNew: 1877075K-&gt;159618K(1887488K), 0.2674537 secs] 3508407K-&gt;1803795K(7130368K), 0.2677172 secs] [Times: user=0.35 sys=0.00, real=0.27 secs]</p>
<p>   2018-04-28T15:48:22.040+0800: 1350.331: [CMS-concurrent-sweep: 3.127/3.801 secs] [Times: user=11.04 sys=0.50, real=3.80secs]</p>
<p>   2018-04-28T15:48:22.040+0800: 1350.331: [CMS-concurrent-reset-start]<br>   2018-04-28T15:48:22.051+0800: 1350.343: [CMS-concurrent-reset: 0.011/0.011 secs] [Times: user=0.04 sys=0.00, real=0.01secs]</p>
<p>   2018-04-28T15:48:22.683+0800: 1350.975: [GC (Allocation Failure) 1350.975: [ParNew: 1837442K-&gt;204471K(1887488K),0.4063115 secs] 2327686K-&gt;697104K(7130368K), 0.4065654 secs] [Times: user=0.47 sys=0.00, real=0.40 secs]</p>
<ul>
<li><p>CMS Initial Mark </p>
<p>åˆå§‹æ ‡è®°ã€‚STWã€‚old sizeï¼š4076417Kï¼Œold capacity:5242880Kï¼Œheap size(ä¸åŒ…æ‹¬perm):4093238K,heap size:7130368K</p>
</li>
<li><p>CMS-concurrent-preclean</p>
</li>
<li><p>CMS Final Remark</p>
<p>æœ€ç»ˆæ ‡è®°ã€‚STWã€‚</p>
<p>[YG occupancy: 1685779 K (1887488 K)]1345.719: [Rescan (parallel) , 0.3523662 secs]1346.071: [weak refs processing, 0.3003263 secs]1346.372: [class unloading, 0.1228579 secs]1346.495: [scrub symbol table, 0.0134209 secs]1346.508: [scrub string table, 0.0023638 secs][1 CMS-remark: 4076417K(5242880K)] 5762197K(7130368K), 0.7958359 secs] [Times: user=1.85 sys=0.00, real=0.80 secs]</p>
<p>young size:1685779K</p>
<p>young capacity:1887488 K</p>
<p>heap size:5762197K</p>
<p>heap capacity:7130368K</p>
</li>
<li><p>åˆ†æä¸€ä¸‹CMS-concurrent-sweep-start ä»¥åçš„å‡ æ¬¡ParNewï¼š</p>
</li>
</ul>
<pre><code>| æ¬¡æ•° | young size before MinorGC | young size after MinorGC | heap size before MinorGC | heap size after MinorGC |
| ---- | ------------------------- | ------------------------ | ------------------------ | ----------------------- |
| 1    | 1867207K                  | 199251K                  | 5812075K                 | 4163268K                |
| 2    | 1877075K                  | 159618K                  | 3508407K                 | 1803795K                |
| 3    | 1837442K                  | 204471K                  | 2327686K                 | 697104K                 |
</code></pre><p>â€‹     ä»è¡¨æ ¼ä¸­è®¡ç®—ï¼Œcmså‰åï¼Œold sizeï¼šä»4163268K-199251K  å¤§çº¦å°†ä¸º697104K-204471Kã€‚</p>
<ol start="2">
<li><p>cmså‚æ•°è°ƒæ•´æ€ä¹ˆç®—ä¼˜ç§€ï¼Ÿ</p>
<p>æ ‡å‡†ï¼šä»¥å¯¹è±¡ä»æ–°ç”Ÿä»£æå‡åˆ°è€å¹´ä»£çš„é€Ÿåº¦å¯¹è€å¹´ä»£ä¸­çš„å¯¹è±¡è¿›è¡Œæ”¶é›†ã€‚</p>
<p>è¾¾ä¸åˆ°è¿™ä¸ªæ ‡å‡†åˆ™ç§°ä¹‹ä¸ºå¤±é€Ÿ(Lost the Race)ã€‚å¤±é€Ÿä¼šå¯¼è‡´Stop-The-World å‹ç¼©å¼åƒåœ¾æ”¶é›†(å•çº¿ç¨‹çš„Serial Old FullGC)ã€‚é¿å…å¤±é€Ÿçš„å…³é”®æ˜¯è¦ç»“åˆè¶³å¤Ÿå¤§çš„è€å¹´ä»£å’Œè¶³å¤Ÿå¿«åœ°åˆå§‹åŒ–CMSåƒåœ¾æ”¶é›†å‘¨æœŸï¼Œè®©å®ƒä»¥æ¯”æå‡é€Ÿç‡æ›´å¿«çš„é€Ÿåº¦å›æ”¶ç©ºé—´ã€‚</p>
</li>
<li><p>concurrent mode failure</p>
<ul>
<li>å½“CMS GCè¿›è¡Œè¿‡ç¨‹ä¸­ï¼ŒMinor GCå‘è€å¹´ä»£æå‡çš„é€Ÿåº¦å¿«äºæ”¶é›†å™¨æ”¶é›†çš„é€Ÿåº¦ã€‚</li>
<li>CMS å’ŒMinorGCåŒæ—¶è¿›è¡Œæ—¶ï¼Œæ–°ç”Ÿä»£Survivorç©ºé—´æ”¾ä¸ä¸‹ï¼Œéœ€è¦æå‡åˆ°è€å¹´ä»£ã€‚</li>
<li>CMSè¿›è¡Œæ—¶ï¼Œä¸šåŠ¡å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œè€å¹´ä»£æ”¾ä¸ä¸‹ã€‚</li>
</ul>
<p>ä¸Šè¿°ä¸‰ç§ä¼šå¯¼è‡´è¯¥ç°è±¡å‘ç”Ÿã€‚</p>
</li>
</ol>
<p>   å‘ç”Ÿå‹ç¼©å¼åƒåœ¾æ”¶é›†æ—¶ï¼Œcms gc logä¼šå‡ºç°å¹¶å‘æ¨¡å¼å¤±æ•ˆ(Concurrent Mode Failure)æ—¥å¿—ï¼š</p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2018-04-30T08:27:57.376+0800: 147363.218: [GC (Allocation Failure) 147363.223: [ParNew: 2831168K-&gt;2831168K(2831168K), 0.0018961 secs]147363.225: [CMS2018-04-30T08:28:01.910+0800: 147367.747: [CMS-concurrent-sweep: 45.882/77.866 secs] [Times: user=138.72 sys=18.07, real=77.88 secs](concurrent mode failure): 4045869K-&gt;745862K(4194304K), 38.8136017 secs] 6877037K-&gt;745862K(7025472K), [Metaspace: 125954K-&gt;125954K(1167360K)], 38.8679322 secs] [Times: user=4.18 sys=1.47, real=38.86 secs]</span><br></pre></td></tr></table></figure>
<p>   MinorGC å‰åï¼šyoung sizeéƒ½æ˜¯2831168K ï¼Œè¯´æ˜MinorGCæ”¶é›†ä¸äº†ï¼Œè€Œcmså¯åŠ¨æ—¶ï¼ŒoldåŒºçš„å¯ç”¨ç©ºé—´ä¸º5G*30%ï¼Œæ”¾ä¸ä¸‹youngç©ºé—´çš„æ•°æ®ï¼Œå¯¼è‡´STWï¼Œç„¶åè½¬åŒ–ä¸ºå•çº¿ç¨‹çš„FullGCã€‚ä¾‹å­ä¸­FullGCè€—æ—¶38.86sã€‚</p>
<ol start="4">
<li><p>promotion failed</p>
<p>MinorGCæ—¶ï¼ŒSruvivor spaceæ”¾ä¸ä¸‹ï¼Œåªèƒ½æ”¾åˆ°è€å¹´ä»£ï¼Œè€Œæ­¤æ—¶è€å¹´ä»£ä¹Ÿæ”¾ä¸ä¸‹ï¼Œæ­¤æ—¶ä¼šå¯¼è‡´STW ä½¿ç”¨Serial Oldæ”¶é›†å™¨è¿›è¡ŒFull GC.</p>
</li>
</ol>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<p><a href="http://itindex.net/detail/47030-cms-gc-%E9%97%AE%E9%A2%98" target="_blank" rel="noopener">http://itindex.net/detail/47030-cms-gc-%E9%97%AE%E9%A2%98</a></p>
<p><a href="http://www.oracle.com/technetwork/java/javase/tech/index.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/tech/index.html</a></p>
<p><a href="http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html</a></p>
<p><a href="https://www.jianshu.com/p/ca1b0d4107c5" target="_blank" rel="noopener">https://www.jianshu.com/p/ca1b0d4107c5</a></p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/04/26/java/tomcatå¼‚å¸¸åˆ†æ/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/04/17/zookeeper/zookeeper/">zookeeperæ³¨æ„ç‚¹</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-04-16T16:00:00.000Z">2018-04-17</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <ul>
<li><p>èŠ‚ç‚¹ä¸è¦å¤ªå¤š</p>
<p>å…¨å†…å­˜çš„èŠ‚ç‚¹ï¼Œå¾ˆå®¹æ˜“fgcï¼Œstwï¼Œclientç«¯å°±ä¸æ–­reconnect</p>
</li>
<li><p>watchä¸è¦å¤ªå¤š</p>
<p>å¤ªå¤šä¼šå¯¼è‡´åŒ…å¤ªå¤§</p>
</li>
<li><p>serverä¸Šä¸‹çº¿è¦ä¼˜å…ˆä¿®æ”¹é…ç½®</p>
<p>â€‹</p>
</li>
</ul>
<h3 id="Rolling-Restart-in-Apache-ZooKeeper-to-dynamically-add-servers-to-the-Ensemble"><a href="#Rolling-Restart-in-Apache-ZooKeeper-to-dynamically-add-servers-to-the-Ensemble" class="headerlink" title="Rolling Restart in Apache ZooKeeper to dynamically add servers to the Ensemble"></a>Rolling Restart in Apache ZooKeeper to dynamically add servers to the Ensemble</h3><p>As of the writing of this post there is currently no way in Apache ZooKeeper to dynamically add a master ZooKeeper server to the ZooKeeper Ensemble.  That is until <a href="https://issues.apache.org/jira/browse/ZOOKEEPER-107" target="_blank" rel="noopener">https://issues.apache.org/jira/browse/ZOOKEEPER-107</a> is resolved.</p>
<p>As a work around there is a process known as the ZooKeeper ensemble rolling restart to get around this issue.</p>
<p>When you specify your zookeeper ensemble you setup a config file that holds the other zookeeper servers in the ensemble that it should attach to.  By modifying this file, according to the following steps, will allow you to add a zookeeper server to the ensemble without needing to take the service as a whole offline.  This could be due to a server replacement if a server goes down (and has to account for a DNS or IP address change) or if you want to expand the zookeeper cluster.</p>
<ol>
<li>Modify your /config/zoo.cfg file to hold the new list of servers with your new addition.  If you wanted to grow from 7 servers to 9 servers then you would be adding in information about server 8 and 9.<ol>
<li>server.8=host:port:electionport</li>
<li>server.9=host:port:electionport</li>
<li>Ensure that server 8 and 9 are turned on and ready to go.  Start the ZooKeeper process on those servers.  They will follow the currently elected leader.</li>
<li>Go through zookeeper servers 1-7 one by one and update the /config/zoo.cfg file so that they have information on zookeeper servers 8 and 9.  Restart the ZooKeeper service on that server.</li>
<li>As you restart each server in step 3 above â€“ ensure to watch your traffic and connection graphs on the other servers.  This is to ensure that the dropped connections from the other master get properly reassigned to other servers in the cluster.</li>
</ol>
</li>
</ol>
<p>While this is not an officially supported method for adding servers to the cluster â€“ this is a method that will work,.  In fact it has been performed in a production environment with over 10,000 client connections attached to the ZooKeeper ensemble.  This has worked for </p>
<p>1) needing to update DNS entries or IP address,</p>
<p>2) replacing failed hardware and </p>
<p>3) expanding a cluster to be a larger size.</p>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/04/17/zookeeper/zookeeper/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/04/17/java/CompletableFuture/">java.util.concurrent.CompletableFuture</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-04-16T16:00:00.000Z">2018-04-17</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><ul>
<li>supplyAsync å‘ForkJoinPool.commonPoolï¼ˆæˆ–è€…ä¸€ä¸ªæŒ‡å®šçš„Executorï¼‰æäº¤ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶åŒ…å«ä¸€ä¸ªè¿”å›å€¼ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„CompletableFuture</li>
<li>runAsync å‘ForkJoinPool.commonPoolï¼ˆæˆ–è€…ä¸€ä¸ªæŒ‡å®šçš„Executorï¼‰æäº¤ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ— è¿”å›å€¼ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„CompletableFuture</li>
</ul>
<p>CompletableFutureåŒ…å«å‡ ä¸ªå…³é”®å±æ€§</p>
<p>result ï¼šFutureæ‰§è¡Œçš„ç»“æœæˆ–é”™è¯¯ï¼ˆAltResultï¼‰</p>
<p>Completion stack : treiber stack ï¼Œå¤šä¸ªæ“ä½œï¼Œä¾‹å¦‚supplyAsync,thenApplyAsyncï¼Œä¼šç»„åˆä¸ºæ ˆ</p>
<p>å®ä¾‹ï¼š</p>
<ol>
<li><p>stageA=CompletableFuture.supplyAsync(supplierA)<br>supplyAsyncè¿”å›åï¼š</p>
<p>stackï¼šnull</p>
<p>resultï¼šå¦‚æœsupplierAæ‰§è¡Œå®Œï¼Œåˆ™resultä¸ºå…¶è¿”å›å€¼ï¼Œå¦åˆ™ä¸ºnull</p>
</li>
<li><p>stageB=stageA.thenApplySync(functionB)</p>
<p>stageA.stack UniApply</p>
<p>â€‹    src=stageA</p>
<p>â€‹    dep=stageB</p>
</li>
<li><p>stageC=stageB.thenApplySync(functionC)</p>
<p>stageB.stack UniApply</p>
<p>â€‹    src=stageB</p>
<p>â€‹    dep=stageC</p>
</li>
</ol>
<p>supplierA,functionB,functionC å‡ä¸ºè€—æ—¶æ“ä½œï¼Œå¦‚æœsupplierAæ‰§è¡Œå¾ˆå¿«ï¼Œåœ¨ç¬¬äºŒéƒ¨å®Œæˆæ—¶ï¼ŒstagetA.stackå¯èƒ½ä¸ºnullï¼Œä¸éœ€è¦åˆå§‹åŒ–stageAçš„stack</p>
<ol>
<li>supplyAsyncè°ƒç”¨asyncSupplyStageå®Œæˆå®ç°ï¼Œå®é™…ä¸Šå°±æ˜¯ç”Ÿæˆä¸€ä¸ªAsyncSupplyå¯¹è±¡ï¼Œæäº¤åˆ°çº¿ç¨‹æ± ã€‚å½“åªè°ƒç”¨supplyAsyncè€Œä¸”æ²¡æœ‰åç»­æ“ä½œæ—¶ï¼Œè¯¥æ–¹æ³•è¿”å›CompleteFutureï¼Œå’Œæ™®é€šçš„Futureæ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;U&gt; <span class="function">CompletableFuture&lt;U&gt; <span class="title">asyncSupplyStage</span><span class="params">(Executor e,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                    Supplier&lt;U&gt; f)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (f == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">       CompletableFuture&lt;U&gt; d = <span class="keyword">new</span> CompletableFuture&lt;U&gt;();</span><br><span class="line">       e.execute(<span class="keyword">new</span> AsyncSupply&lt;U&gt;(d, f));</span><br><span class="line">       <span class="keyword">return</span> d;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncSupply</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">ForkJoinTask</span>&lt;<span class="title">Void</span>&gt;</span></span><br><span class="line"><span class="class">           <span class="keyword">implements</span> <span class="title">Runnable</span>, <span class="title">AsynchronousCompletionTask</span> </span>&#123;</span><br><span class="line">       CompletableFuture&lt;T&gt; dep; Supplier&lt;T&gt; fn;</span><br><span class="line">       AsyncSupply(CompletableFuture&lt;T&gt; dep, Supplier&lt;T&gt; fn) &#123;</span><br><span class="line">           <span class="keyword">this</span>.dep = dep; <span class="keyword">this</span>.fn = fn;</span><br><span class="line">       &#125;</span><br><span class="line">	</span><br><span class="line">	... </span><br><span class="line">	</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           CompletableFuture&lt;T&gt; d; Supplier&lt;T&gt; f;</span><br><span class="line">           <span class="keyword">if</span> ((d = dep) != <span class="keyword">null</span> &amp;&amp; (f = fn) != <span class="keyword">null</span>) &#123;</span><br><span class="line">               dep = <span class="keyword">null</span>; fn = <span class="keyword">null</span>;</span><br><span class="line">               <span class="keyword">if</span> (d.result == <span class="keyword">null</span>) &#123;</span><br><span class="line">                   <span class="keyword">try</span> &#123;</span><br><span class="line">                   	<span class="comment">//f.get supplyAsyncåˆå§‹åŒ–çš„Supplier</span></span><br><span class="line">                   	<span class="comment">//completeValue ä¼šå°†æ‰§è¡Œç»“æœèµ‹å€¼ç»™dçš„result</span></span><br><span class="line">                       d.completeValue(f.get());</span><br><span class="line">                   &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                   	<span class="comment">//å¦‚æœå¤±è´¥ï¼ŒcompleteThrowableä¼šå°†ç»“æœå¤åˆ¶ç»™resultï¼ŒAltResultç±»å‹</span></span><br><span class="line">                       d.completeThrowable(ex);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">//åœ¨å®ä¾‹ä¸­ï¼Œå½“supplierAå®Œæˆåï¼Œä¼šè°ƒç”¨dep(å³stageB)çš„postComplete,postComplete--&gt;tryFile--&gt;uniApply(æˆ–è€…biApplyç­‰æ–¹æ³•)--&gt;dep.fn.apply(ä¼ å…¥stageAçš„è¿”å›å€¼),åŒæ ·åœ¨stageBæ‰§è¡Œå®Œï¼Œä¼šè§¦å‘stageC.postComplete</span></span><br><span class="line">               d.postComplete();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Pops and tries to trigger all reachable dependents.  Call only</span></span><br><span class="line"><span class="comment">    * when known to be done.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">postComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * On each step, variable f holds current dependents to pop</span></span><br><span class="line"><span class="comment">        * and run.  It is extended along only one path at a time,</span></span><br><span class="line"><span class="comment">        * pushing others to avoid unbounded recursion.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       CompletableFuture&lt;?&gt; f = <span class="keyword">this</span>; Completion h;</span><br><span class="line">       <span class="keyword">while</span> ((h = f.stack) != <span class="keyword">null</span> ||</span><br><span class="line">              (f != <span class="keyword">this</span> &amp;&amp; (h = (f = <span class="keyword">this</span>).stack) != <span class="keyword">null</span>)) &#123;</span><br><span class="line">           CompletableFuture&lt;?&gt; d; Completion t;</span><br><span class="line">           <span class="keyword">if</span> (f.casStack(h, t = h.next)) &#123;</span><br><span class="line">               <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123;</span><br><span class="line">                   <span class="keyword">if</span> (f != <span class="keyword">this</span>) &#123;</span><br><span class="line">                       pushStack(h);</span><br><span class="line">                       <span class="keyword">continue</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   h.next = <span class="keyword">null</span>;    <span class="comment">// detach</span></span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">//tryFire</span></span><br><span class="line">               f = (d = h.tryFire(NESTED)) == <span class="keyword">null</span> ? <span class="keyword">this</span> : d;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><p>thenApplyAsync  å®ç°ï¼Œå¦‚æœå®ä¾‹ä¸­Aå·²ç»æ‰§è¡Œå®Œæˆï¼Œå³å½“å‰Completable.resultæœ‰è¿”å›å€¼ï¼Œåˆ™å°è¯•æ‰§è¡ŒBã€‚å¦‚æœAæ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œåˆ™è¿”å›ä¸€ä¸ªCompletableFuture.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;V&gt; <span class="function">CompletableFuture&lt;V&gt; <span class="title">uniApplyStage</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">       Executor e, Function&lt;? <span class="keyword">super</span> T,? extends V&gt; f)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (f == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">       CompletableFuture&lt;V&gt; d =  <span class="keyword">new</span> CompletableFuture&lt;V&gt;();</span><br><span class="line">       <span class="comment">// åˆ¤æ–­æ˜¯å¦è¦åŠ å…¥åˆ°stackä¸­</span></span><br><span class="line">       <span class="keyword">if</span> (e != <span class="keyword">null</span> || !d.uniApply(<span class="keyword">this</span>, f, <span class="keyword">null</span>)) &#123;</span><br><span class="line">           UniApply&lt;T,V&gt; c = <span class="keyword">new</span> UniApply&lt;T,V&gt;(e, d, <span class="keyword">this</span>, f);</span><br><span class="line">           <span class="comment">//this.stack=c</span></span><br><span class="line">           <span class="comment">//c.dep=d</span></span><br><span class="line">           <span class="comment">//c.src=this</span></span><br><span class="line">           push(c);</span><br><span class="line">           <span class="comment">//å°è¯•è°ƒç”¨f</span></span><br><span class="line">           c.tryFire(SYNC);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> d;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(UniCompletion&lt;?,?&gt; c)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (c != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="comment">//result==null this.resultä¸ä¸ºnullï¼Œå³å½“å‰CompletableFutureæœªæ‰§è¡Œå®Œ</span></span><br><span class="line">           <span class="keyword">while</span> (result == <span class="keyword">null</span> &amp;&amp; !tryPushStack(c))</span><br><span class="line">               lazySetNext(c, <span class="keyword">null</span>); <span class="comment">// clear on failure</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryPushStack</span><span class="params">(Completion c)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//å½“å‰CompletableFutureçš„stackï¼Œå¦‚æœ	</span></span><br><span class="line">       <span class="comment">//CompletableFuturesupplyAsync().thenApplyAsync,stack=null</span></span><br><span class="line">       Completion h = stack;</span><br><span class="line">       <span class="comment">//å°†cçš„nextè®¾ç½®ä¸ºh</span></span><br><span class="line">       lazySetNext(c, h);</span><br><span class="line">       <span class="comment">//å°†this.stack è®¾ç½®ä¸ºc</span></span><br><span class="line">       <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, STACK, h, c);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>â€‹</p>
</li>
<li><p>AsyncSupply.runâ€”&gt;stageA.postCompleteâ€”&gt;stageB.tryFire(NEASTED)â€”&gt;stageB.uniApplyâ€”&gt;stageB.claim(æäº¤åˆ°Executorå¼‚æ­¥å¤„ç†)</p>
<p>å°±æ˜¯å°†UniApplyæäº¤åˆ°Executorï¼ŒExecutorè°ƒç”¨tryFire(ASYNC)</p>
<p>â€”&gt;uniApply(c=null)</p>
<p>â€”&gt;completeValue(f.apply(s)) //å®é™…ä¸šåŠ¡ä»£ç </p>
<p>â€”&gt;postFire</p>
<p>â€”&gt;postComplete</p>
<p>â€”&gt;åŒä¸Šï¼Œæ¯ä¸ªuniApplyä¾æ¬¡è°ƒç”¨ã€‚</p>
<p>tryFire ä¸åŒçš„å‚æ•°ï¼Œä¸åŒçš„é€»è¾‘ï¼Œä¹Ÿæ˜¯ç¥å¥‡ã€‚</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> &lt;S&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">uniApply</span><span class="params">(CompletableFuture&lt;S&gt; a,</span></span></span><br><span class="line"><span class="function"><span class="params">                           Function&lt;? <span class="keyword">super</span> S,? extends T&gt; f,</span></span></span><br><span class="line"><span class="function"><span class="params">                           UniApply&lt;S,T&gt; c)</span> </span>&#123;</span><br><span class="line">    Object r; Throwable x;</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="keyword">null</span> || (r = a.result) == <span class="keyword">null</span> || f == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    tryComplete: <span class="keyword">if</span> (result == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (r <span class="keyword">instanceof</span> AltResult) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((x = ((AltResult)r).ex) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                completeThrowable(x, r);</span><br><span class="line">                <span class="keyword">break</span> tryComplete;</span><br><span class="line">            &#125;</span><br><span class="line">            r = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (c != <span class="keyword">null</span> &amp;&amp; !c.claim())</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>) S s = (S) r;</span><br><span class="line">            completeValue(f.apply(s));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">            completeThrowable(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/04/17/java/CompletableFuture/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/04/17/hystrix/hystrix-configuration/">hystrix configuration</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-04-16T16:00:00.000Z">2018-04-17</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h1 id="Command-Properties"><a href="#Command-Properties" class="headerlink" title="Command Properties"></a>Command Properties</h1><h2 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h2><ul>
<li><p>execution.isolation.strategy  </p>
<p>default:THREAD</p>
<p>HystrixCommand.run æ‰§è¡Œçš„éš”ç¦»ç­–ç•¥ã€‚</p>
<p>THREADï¼šåœ¨çº¿ç¨‹æ± çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p>
<p>SEMAPHOREï¼šåœ¨è°ƒç”¨çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œæœ€å¤§å¹¶å‘æ•°å—ä¿¡å·é‡æ•°é‡æ§åˆ¶ã€‚</p>
<p>HystrixCommandæ¨èTHREADï¼ŒHystrixObservableCommandæ¨èSEMAPHORE</p>
</li>
<li><p>execution.isolation.thread.timeoutInMilliseconds</p>
<p>default:1000</p>
<p>è°ƒç”¨è¶…æ—¶æ—¶é—´ã€‚Hystrixä¼šå°†è¯¥Commandç½®ä¸ºTIMEOUTï¼Œè°ƒç”¨fallbacké€»è¾‘ã€‚</p>
</li>
<li><p>execution.timeout.enabled</p>
<p>default:true</p>
<p>Command.runæ˜¯å¦æœ‰è¶…æ—¶</p>
</li>
<li><p>execution.isolation.thread.interruptOnTimeout</p>
<p>default:true</p>
<p>è¶…æ—¶æ—¶ï¼Œæ˜¯å¦ä¸­æ–­Command</p>
</li>
<li><p>execution.isolation.thread.interruptOnCancel</p>
<p>default:false</p>
<p>å½“Cancelæ—¶ï¼Œæ˜¯å¦ä¸­æ–­Command</p>
</li>
<li><p>execution.isolation.semaphore.maxConcurrentRequests</p>
<p>default:10</p>
<p>å½“ä½¿ç”¨ExecutionIsolationStrategy.SEMAPHOREæ—¶ï¼Œcommandæœ€å¤§è¯·æ±‚æ•°é‡</p>
</li>
</ul>
<h2 id="Fallback"><a href="#Fallback" class="headerlink" title="Fallback"></a>Fallback</h2><ul>
<li><p>fallback.isolation.semaphore.maxConcurrentRequests</p>
<p>default:10</p>
<p>fallbackå¹¶å‘æ•°ï¼Œè¶…è¿‡è¿”å›Exception</p>
</li>
<li><p>fallback.enabled</p>
<p>default:true</p>
</li>
</ul>
<h2 id="Circuit-Breaker"><a href="#Circuit-Breaker" class="headerlink" title="Circuit Breaker"></a>Circuit Breaker</h2><ul>
<li><p>circuitBreaker.enabled</p>
<p>default:true</p>
</li>
<li><p>circuitBreaker.requestVolumeThreshold</p>
<p>default:20</p>
<p>åœ¨ä¸€ä¸ªçª—å£ä¸­ï¼Œå¯ä»¥è§¦å‘circuitBreakerçš„æœ€å°è¯·æ±‚æ•°ï¼Œ19ä¸ªè¯·æ±‚ï¼Œå³ä½¿å…¨éƒ¨å¤±è´¥ä¹Ÿä¸ä¼šè§¦å‘circuitBreaker</p>
</li>
<li><p>circuitBreaker.sleepWindowInMilliseconds</p>
<p>default:5000</p>
<p>circuitBreakerè¢«è§¦å‘åï¼ŒcircuitBreakerä¼šåœ¨è¯¥æ—¶é—´æ®µå†…æ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œè¯¥æ—¶é—´è¿‡åï¼Œä¼šå°è¯•æ‰§è¡Œrunï¼Œå¦‚æœæˆåŠŸæ‰§è¡Œï¼Œä¼šå°†circuitBreakerå…³é—­ï¼Œå¦åˆ™ä¸€ç›´æ‰“å¼€ã€‚</p>
</li>
<li><p>circuitBreaker.errorThresholdPercentage</p>
<p>default:50</p>
<p>åœ¨çª—å£å†…ï¼Œå¤±è´¥è¯·æ±‚çš„æ¯”ä¾‹</p>
</li>
<li><p>circuitBreaker.forceOpen</p>
<p>default:false</p>
<p>æ‰“å¼€circuitBreakerï¼Œæ‹’ç»æ‰€æœ‰è¯·æ±‚</p>
</li>
<li><p>circuitBreaker.forceClosed</p>
<p>default:false</p>
<p>å…³é—­circuitBreaker</p>
</li>
</ul>
<h2 id="Metrics"><a href="#Metrics" class="headerlink" title="Metrics"></a>Metrics</h2><ul>
<li><p>metrics.rollingStats.timeInMilliseconds</p>
<p>default:10000</p>
<p>çª—å£å¤§å°ï¼Œä¿ç•™å¤šé•¿æ—¶é—´çš„ç»Ÿè®¡ä¿¡æ¯æ¥å†³å®šæ˜¯å¦ä½¿ç”¨circuitBreakerã€‚</p>
</li>
<li><p>metrics.rollingStats.numBuckets</p>
<p>default:10</p>
<p>çª—å£åŒ…å«çš„bucketæ•°é‡</p>
</li>
<li><p>metrics.rollingPercentile.enabled</p>
<p>default:true</p>
<p>å»¶è¿Ÿæ‰§è¡Œæ˜¯å¦è¢«è·Ÿè¸ªå¹¶æŒ‰ç™¾åˆ†æ¯”å±•ç¤º</p>
<p>â€‹</p>
<ul>
<li>metrics.rollingPercentile.timeInMilliseconds</li>
</ul>
</li>
</ul>
<ul>
<li>â€‹</li>
</ul>
<h2 id="Request-Context"><a href="#Request-Context" class="headerlink" title="Request Context"></a>Request Context</h2><h1 id="Collapser-Properties"><a href="#Collapser-Properties" class="headerlink" title="Collapser Properties"></a>Collapser Properties</h1><h1 id="Thread-Pool-Properties"><a href="#Thread-Pool-Properties" class="headerlink" title="Thread Pool Properties"></a>Thread Pool Properties</h1>
          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/04/17/hystrix/hystrix-configuration/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/04/17/spring/springmvc/">è¿”å›å€¼å¤„ç†</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-04-16T16:00:00.000Z">2018-04-17</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h2 id="è¿”å›å€¼å¤„ç†"><a href="#è¿”å›å€¼å¤„ç†" class="headerlink" title="è¿”å›å€¼å¤„ç†"></a>è¿”å›å€¼å¤„ç†</h2><ul>
<li>ResponseBodyAdvice</li>
<li>HandlerMethodReturnValueHandler</li>
<li>ExceptionHandler</li>
</ul>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/04/17/spring/springmvc/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/04/17/java/Java8å®æˆ˜/">java8</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-04-16T16:00:00.000Z">2018-04-17</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <h2 id="è¡Œä¸ºå‚æ•°åŒ–"><a href="#è¡Œä¸ºå‚æ•°åŒ–" class="headerlink" title="è¡Œä¸ºå‚æ•°åŒ–"></a>è¡Œä¸ºå‚æ•°åŒ–</h2><p>è®©æ–¹æ³•æ¥å—å¤šç§è¡Œä¸ºä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨å†…éƒ¨ä½¿ç”¨ï¼Œæ¥å®Œæˆä¸åŒçš„è¡Œä¸ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public static List&lt;Apple&gt; filterApples(List&lt;Apple&gt; inventory,ApplePredicate p)&#123;</span><br><span class="line">    List&lt;Apple&gt; result=new ArrayList&lt;&gt;();</span><br><span class="line">    for(Apple apple:inventory)&#123;</span><br><span class="line">        if(p.test(apple))&#123;</span><br><span class="line">            result.add(apple);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/04/17/java/Java8å®æˆ˜/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>




  <article class="post">
  
  
    <div class="post-content-index">
  
      
        <header>
          <!-- <div class="icon"></div> -->
            
    
      <h1 class="metro-title transition"><a href="/2018/04/17/books/">å¾…è¯»ä¹¦ç›®</a></h1>
    
  
          <ul>
            <li>
              <span class="heading-span">Posted on: </span>
              <time datetime="2018-04-16T16:00:00.000Z">2018-04-17</time>
            </li>
            
              <li>
                <span class="heading-span">By: </span>

                
                  <a href="/">hello world</a>
                

              </li>
            
            <li>
              <span class="heading-span">With: </span>
              
          </ul>
        </header>
      
      <div class="entry">
        
          
            <ol>
<li>æ•°æ®åº“ç³»ç»Ÿå®ç°</li>
</ol>

          
        
      </div>
      <footer>
        
          <div class="alignright">
            <a href="/2018/04/17/books/#more" class="more-link">Continue Reading<i class="fa fa-long-arrow-right fa-1"></i></a>
          </div>
        
        <div class="clearfix"></div>
      </footer>
    </div>
</article>





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright"><div class="padding">
	
	  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:unei.me">
  </form>
</div>
	
	  
<div class="widget recent-post">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2018/05/10/os/å†…å­˜/">å†…å­˜</a>
      </li>
    
      <li>
        <a href="/2018/05/04/java/ParallelScavengeå’ŒParNew/"></a>
      </li>
    
      <li>
        <a href="/2018/05/03/java/gcåŸºç¡€/"></a>
      </li>
    
      <li>
        <a href="/2018/04/26/java/tomcatå¼‚å¸¸åˆ†æ/">tomcatå¼‚å¸¸åˆ†æ</a>
      </li>
    
      <li>
        <a href="/2018/04/17/zookeeper/zookeeper/">zookeeperæ³¨æ„ç‚¹</a>
      </li>
    
  </ul>
</div>

	
	  
<div class="widget category">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/books/">books</a><small>1</small></li>
  
    <li><a href="/categories/git/">git</a><small>1</small></li>
  
    <li><a href="/categories/golang/">golang</a><small>4</small></li>
  
    <li><a href="/categories/hystrix/">hystrix</a><small>2</small></li>
  
    <li><a href="/categories/java/">java</a><small>6</small></li>
  
    <li><a href="/categories/kafka/">kafka</a><small>3</small></li>
  
    <li><a href="/categories/linux/">linux</a><small>3</small></li>
  
    <li><a href="/categories/mysql/">mysql</a><small>1</small></li>
  
    <li><a href="/categories/network/">network</a><small>7</small></li>
  
    <li><a href="/categories/os/">os</a><small>1</small></li>
  
    <li><a href="/categories/redis/">redis</a><small>1</small></li>
  
    <li><a href="/categories/ruby/">ruby</a><small>2</small></li>
  
    <li><a href="/categories/spring/">spring</a><small>3</small></li>
  
    <li><a href="/categories/zookeeper/">zookeeper</a><small>1</small></li>
  
    <li><a href="/categories/æ€»ç»“/">æ€»ç»“</a><small>1</small></li>
  
  </ul>
</div>

	
	  
	
</div></aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="padding">
	<div class="alignleft">
	  
	  &copy; 2018 hello world
	  
	  Powerd by <a href="http://hexo.io/" target="_blank">hexo</a>
	  and Theme by <a href="https://github.com/halfer53/metro-light" target="_blank">metro-light</a>
	</div>

	<div class="alignright">
		
		
		
		
		
		
		
	</div>

	<div class="clearfix"></div>
</div>

<div class="scroll-top"><i class="fa fa-arrow-circle-up"></i></div></footer>
  


<link href='http://apps.bdimg.com/libs/fontawesome/4.1.0/css/font-awesome.css' rel='stylesheet' type='text/css'>
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>



<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.0.4/jquery.imagesloaded.js"></script> -->
<!-- <script src="/js/gallery.js"></script> -->



<script type="text/javascript">
$(window).scroll(function() {

    if($(this).scrollTop() > 400) {
        $('.scroll-top').fadeIn(200);
    } else {
        $('.scroll-top').fadeOut(200);
    }
});

$('.scroll-top').bind('click', function(e) {
    e.preventDefault();
    $('body,html').animate({scrollTop:0},200);
});
</script>


</body>
</html>
